

<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- Theme for mobile Chrome -->
  <meta name="theme-color" content="#e74c3c">

  <title>Перебирающие методы массивов изнутри</title>
  <meta name="description" content="Методы массивов forEach, map, filter, some, every и reduce являются неотъемлимой частью функционального программирования на JavaScript. В этой статье подробн...">
   
  <!-- Link favicon -->
  <link rel="shortcut icon" href="http://jsraccoon.ru/favicon.ico" type="image/x-icon">
  <link rel="icon" href="http://jsraccoon.ru/favicon.ico" type="image/x-icon">

  <!-- Link Google Fonts: Open Sans for headings, Arimo for content, Roboto Mono for code blocks -->
  <link href='https://fonts.googleapis.com/css?family=Arimo:400,400italic,700,700italic|Open+Sans:700,800|Roboto+Mono:400,700,700italic,400italic&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.css">

  <!-- Main CSS File (compiled from _sass forder) -->
  <link rel="stylesheet" href="/css/main.min.css">

  <!-- Canonical url (https://support.google.com/webmasters/answer/139066) -->
  <link rel="canonical" href="http://jsraccoon.ru/fn-array-methods">

  <!-- Regional url (https://support.google.com/webmasters/answer/189077) -->
  <link rel="alternate" type="application/rss+xml" title="Frontend Raccoon" href="http://jsraccoon.ru/feed.xml">
</head>


  <body>
  <p id="post-meta"></p>
    <header class="site-header">
	<div class="wrapper">
		<div class="logo-section">
			<a class="logo" href="http://jsraccoon.ru/">
				<img src="http://jsraccoon.ru/images/logo-raccoon.svg" alt="logo">
			</a>
		</div>
	</div>

	<nav role="navigation" class="site-navbar container">
		<div class="mobile-nav">
			<h2 class="navbar-brand">Frontend <br> <span class="brand-highlight">Raccoon</span></h2>
			<div class="burger-icon">
				<div class="burger"></div>
			</div>
		</div>
		<div class="navbar-toggle">
			<ul class="nav main-section">
				<li><a href="" class="nav-item"><i class="fa fa-home"></i> <span>Главная</span></a></li>
				<li><a href="#0" class="nav-item"><i class="fa fa-bars"></i> <span>Рубрики</span></a></li>
				<li><a href="" class="nav-item"><i class="fa fa-code"></i> <span>Задачи</span></a></li>
				<li><a href="" class="nav-item"><i class="fa fa-file-text-o"></i> <span>Статьи</span></a></li>
			</ul>

			<ul class="nav social-section">
				<li><a href="" class="nav-item_icon"><i class="fa fa-github"></i></a></li>
				<li><a href="" class="nav-item_icon"><i class="fa fa-vk"></i></a></li>
				<li><a href="" class="nav-item_icon"><i class="fa fa-twitter"></i></a></li>
			</ul>
		</div>
	</nav>
</header>


    <div class="page-content">
      <div class="wrapper post-wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Перебирающие методы массивов изнутри</h1>
    <div class="meta-container center"><span class="meta type">
  
  
</span>




  <span class="meta category"><a href="./tag/">
    <i class="meta-icon fa fa-navicon"></i>
    
  </a></span>
</div>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Методы массивов <code>forEach</code>, <code>map</code>, <code>filter</code>, <code>some</code>, <code>every</code> и <code>reduce</code> являются неотъемлимой частью функционального программирования на JavaScript. В этой статье подробно рассмотрим применение каждого из них, а также их реализацию в виде функций.</p>

<h5>forEach</h5>

<p>Самый простой способ разобраться, как работают функции высшего порядка, принимающие callback&#39;и, — самостоятельно переписать несколько нативных методов. Начнём с самого простого метода <code>Array.prototype.forEach</code>. Метод массивов <code>forEach</code> принимает два аргумента: первый (обязательный) — <code>callback</code> функция, которая будет выполнена для каждого элемента массива один раз и второй (необязательный) — значение, которое будет использовано в качестве <code>this</code> при вызове функции <code>callback</code>. Работает это следующим образом:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span><span class="s1">'JavaScript'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'awesome'</span><span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">arr</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// Выведет в консоль</span>
<span class="c1">// JavaScript 0 ["JavaScript","is","awesome"]</span>
<span class="c1">// is 1 ["JavaScript","is","awesome"]</span>
<span class="c1">// awesome 2 ["JavaScript","is","awesome"]</span></code></pre></figure>

<p>В <code>callback</code> функцию передаётся три аргумента: <code>item</code>, соответствующий элементу массива, <code>index</code>, равный номеру элемента в массиве, и <code>arr</code> — ссылка на массив. Таким образом, справедливо следующее выражение <code>arr[index] === item</code>. Аргументам передаваемым в <code>callback</code> функцию можно давать разные названия в зависимости от контекста выполнения — выполнение <code>callback</code> функции от этого не изменится:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">nums</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">num</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// 2 4 6 8 10</span>
<span class="p">});</span></code></pre></figure>

<p>Как я писал выше, помимо <code>callback</code> функции метод <code>forEach</code> принимает ещё один аргумент — значение, которое будет использовано в качестве <code>this</code> при вызове функции <code>callback</code>. Зачем это может понадобиться? По умолчанию <code>this</code> не определён, то есть равен <code>undefined</code>. В некоторых ситуациях, особенно при работе с функциями конструкторами, необходимо задать контекст выполнения <code>callback</code> функции:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">phrase</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">' says '</span> <span class="o">+</span> <span class="nx">phrase</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mumble</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">phrases</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">phrases</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">phrase</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="nx">phrase</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">johnDoe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="s1">'John Doe'</span><span class="p">);</span>
<span class="nx">johnDoe</span><span class="p">.</span><span class="nx">mumble</span><span class="p">([</span><span class="s1">'Hello, World!'</span><span class="p">,</span> <span class="s1">'JS is great'</span><span class="p">,</span> <span class="s1">'I\'m designer and i don\'t have job'</span><span class="p">]);</span></code></pre></figure>

<p>Подобный код, на первый взгляд, может оказаться полностью рабочим. Тем не менее, после его выполнения всё, что мы увидим будет ошибка <code>Cannot read property &#39;say&#39; of undefined</code>. Данная ошибка показывает, что при выполнении метода <code>forEach</code> на передаваемом в метод <code>mumble</code> массиве <code>phrases</code> не задаётся контекст испольнения <code>callback</code> функции. Проще говоря, <code>callback</code> функция пытается выполнить подобный код <code>undefined[say](words)</code>. Решается данная проблема элементарно — передётся второй аргумент в метод <code>forEach</code>, который и указывает ему, что брать за <code>this</code>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// ...</span>
<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mumble</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">arr</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">words</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="nx">words</span><span class="p">);</span>
  <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">johnDoe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="s1">'John Doe'</span><span class="p">);</span>
<span class="nx">johnDoe</span><span class="p">.</span><span class="nx">mumble</span><span class="p">([</span><span class="s1">'Hello, World!'</span><span class="p">,</span> <span class="s1">'JS is great'</span><span class="p">,</span> <span class="s1">'I\'m designer and i don\'t have job'</span><span class="p">]);</span>

<span class="c1">// Выведет в консоль</span>
<span class="c1">// John Doe says Hello, World!</span>
<span class="c1">// John Doe says JS is great</span>
<span class="c1">// John Doe says I'm designer and i don't have job</span></code></pre></figure>

<h5>forEach своими руками</h5>

<p>Теперь, когда вы знаете, как работает <code>forEach</code>, настало время написать функцию, которая делает всё тоже самое. При создании функции <code>each</code> будем руководствоваться тремя правилами:</p>

<ol>
<li>Функция принимает три аргумента: массив, по которому будет происходить итерация, <code>callback</code> фунцию, которая будет выполнена для каждого элемента массива, и значение, которое будет использовано <code>callback</code> функцией в качестве <code>this</code>.</li>
<li><code>callback</code> функция, в свою очередь, также работает с тремя аргументами: текущий элемент массива, индекс элемента, ссылка на сам массив. </li>
<li>Функция ничего не возвращает.</li>
</ol>

<p>Самое очевидное решение: используя цикл <code>for</code> перебрать каждый элемент массива и выполнить передаваемую <code>callback</code> функцию с каждым. Сделать это очень просто:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">each</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">callback</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">arr</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

<p>Функция <code>each</code> будет отлично работать, за исключением того, что не соблюдается часть первого правила — для <code>callback</code> функции нельзя задать контекст, то есть нельзя присвоить значение <code>this</code>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">each</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">nums</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Number: '</span> <span class="o">+</span> <span class="nx">num</span> <span class="o">+</span> <span class="s1">', index: '</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s1">','</span><span class="p">,</span> <span class="nx">nums</span><span class="p">)</span>
<span class="p">});</span>

<span class="c1">// Выведет в консоль</span>
<span class="c1">// Number: 1, index: 0, [1,2,3]</span>
<span class="c1">// Number: 2, index: 1, [1,2,3]</span>
<span class="c1">// Number: 3, index: 2, [1,2,3]</span></code></pre></figure>

<p>Чтобы можно было осуществлять передачу ключевого слова <code>this</code> в функцию <code>each</code> достаточно воспользоваться методом функций <code>call</code>, который позволяет вызвать функцию и явно указать, на что будет указывать ключевое слово <code>this</code>.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">each</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">arr</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

<p>Теперь функция <code>each</code> работает с массивами в точности так, как и метод <code>forEach</code>. Чтобы её протестировать, можно запустить её вместе с кодом из предыдущего примера.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">phrase</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">' says '</span> <span class="o">+</span> <span class="nx">phrase</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mumble</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">phrases</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">each</span><span class="p">(</span><span class="nx">phrases</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">phrase</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="nx">phrase</span><span class="p">);</span>
  <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">johnDoe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="s1">'John Doe'</span><span class="p">);</span>
<span class="nx">johnDoe</span><span class="p">.</span><span class="nx">mumble</span><span class="p">([</span><span class="s1">'Hello, World!'</span><span class="p">,</span> <span class="s1">'JS is great'</span><span class="p">,</span> <span class="s1">'I\'m designer and i don\'t have job'</span><span class="p">]);</span>

<span class="c1">// Выведет в консоль</span>
<span class="c1">// John Doe says Hello, World!</span>
<span class="c1">// John Doe says JS is great</span>
<span class="c1">// John Doe says I'm designer and i don't have job</span></code></pre></figure>

<p>Несмотря на кажущуюся одинаковость метода <code>forEach</code> и написанной нами выше функции <code>each</code>, между ними есть одно очень важное различие: метод <code>forEach</code> работает <strong>только с массивами</strong>, в то время как функция <code>each</code> может также успешно работать с <strong>любыми коллекциями</strong>. </p>

<p>Скорее всего, вы уже видели ранее подобную конструкцию, которую использую многие JavaScript разработчики для итерации по всем элементам из DOM коллекции:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">links</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">links</span><span class="p">;</span> <span class="c1">// коллекция всех ссылок на странице</span>
<span class="p">[].</span><span class="nx">forEach</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">links</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Добавление класса link-active для всех ссылок на странице</span>
  <span class="nx">link</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'link-active'</span><span class="p">);</span> 
<span class="p">});</span></code></pre></figure>

<p>Подобная конструкция может ввести в замешательство практически любого программиста, который раньше не использовал её сам. Подробное объяснение, как именно она работает можно найти в <a href="http://stackoverflow.com/questions/16053357/what-does-foreach-call-do-in-javascript">этом вопросе</a> на Stackoverflow. Нужна она лишь для того, чтобы провести итерацию по всем элементам выбранной DOM коллекции и выполнить <code>callback</code> функцию для каждого из них. При использовании написанной нами функции <code>each</code> надобности в такой хитрой конструкции нет, так как она поддерживает работу не только с массивами, но и с любыми коллекциями, в том числе и коллекциями DOM элементов:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">links</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">links</span><span class="p">;</span> <span class="c1">// коллекция всех ссылок на странице</span>
<span class="nx">each</span><span class="p">(</span><span class="nx">links</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Добавление класса link-active для всех ссылок на странице</span>
  <span class="nx">link</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'link-active'</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>Когда появится широкая поддежка <strong>ES6</strong> метод <code>forEach</code> можно будет использовать с DOM коллекциями более простым способом с помощью оператора <a href="http://jsraccoon.ru/es6-spread-rest/">Spread</a>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[...</span><span class="nx">links</span><span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">link</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'link-active'</span><span class="p">);</span> 
<span class="p">});</span></code></pre></figure>

<h5>map</h5>

<p>Метод массивов <code>map</code> похож по своей функциональности на <code>forEach</code>, но результат выполнения <code>callback</code> функции добавляется в новый массив, который возвращается после последней итерации. Другими словами, результатом метода <code>map</code> всегда является <strong>новый</strong> массив с результатами выполнения функции <code>callback</code> на исходном массиве. </p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Возведение числа в степень соответсвующую его индексу в массиве</span>
  <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Исходный массив nums не изменяется</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">nums</span><span class="p">);</span> <span class="c1">// [10,20,30,40]</span>
<span class="c1">// результат выполнения map, записанный в переменную</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span> <span class="c1">// [1,20,900,64000]</span></code></pre></figure>

<p>Также, как и в случае с <code>forEach</code> <code>map</code> помимо <code>callback</code> функции принимает второй параметр, который позволяет задать контекст и явно указать <code>this</code>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">phrases</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">phrase</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">' says '</span> <span class="o">+</span> <span class="nx">phrase</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">grabPhrases</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">phrases</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">phrases</span> <span class="o">=</span> <span class="nx">phrases</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">phrase</span><span class="p">){</span>
    <span class="c1">// Добавление изменённой строки в новый массив</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="nx">phrase</span><span class="p">);</span>
  <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">johnDoe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="s1">'John Doe'</span><span class="p">);</span>
<span class="nx">johnDoe</span><span class="p">.</span><span class="nx">grabPhrases</span><span class="p">([</span><span class="s1">'Hello, World!'</span><span class="p">,</span> <span class="s1">'JS is great'</span><span class="p">,</span> <span class="s1">'I\'m designer and i don\'t have job'</span><span class="p">]);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">johnDoe</span><span class="p">.</span><span class="nx">phrases</span><span class="p">);</span> 
<span class="c1">// ["John Doe says Hello, World!","John Doe says JS is great","John Doe says I'm designer and i don't have job"]</span></code></pre></figure>

<p>Как вы могли заметить, при использовании <code>map</code> и <code>forEach</code> всегда использовалась анонимная функция в качестве <code>callback</code>. Это совсем не обязательно. Вы можете объвить функцию, которую хотите использовать в качестве <code>callback</code> заранее, а затем просто передать её в качестве параметра.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">slice</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// вернуть первые пять символов из строки</span>
  <span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">frameworks</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Knockout'</span><span class="p">,</span> <span class="s1">'Backbone'</span><span class="p">,</span> <span class="s1">'Angular'</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="nx">slice</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">frameworks</span><span class="p">);</span> <span class="c1">// ["Knock","Backb","Angul"]</span></code></pre></figure>

<p>В некоторых ситуациях можно вообще не создавать отдельную функцию и пользоваться нативными методами. Пример выше, в котором каждое число в массиве возводилось в степень, соответствующую своему индексу, можно значительно сократить:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Длинный вариант с ненужной анонимной функцией</span>
<span class="kd">var</span> <span class="nx">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Короткий вариант, ничего лишнего</span>
<span class="kd">var</span> <span class="nx">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">);</span></code></pre></figure>

<p>Передвая <code>callback</code> функцию подобным образом вы не теряете возможность явно указать <code>this</code>. Таким образом, метод <code>grabPhrases</code> из функции конструктора <code>Person</code> также можно немного сократить:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">grabPhrases</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">phrases</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Ненужная анонимная функция</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">phrases</span> <span class="o">=</span> <span class="nx">phrases</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">phrase</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="nx">phrase</span><span class="p">);</span>
  <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Выполнение функции this.say для каждого элемента массива</span>
<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">grabPhrases</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">phrases</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">phrases</span> <span class="o">=</span> <span class="nx">phrases</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">say</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>В отличие от <code>forEach</code> при использовании <code>map</code> вам становится доступен chaining. Это значит, что вы можете последовательно применить метод на возвращенный после <code>map</code> массив. </p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Получение квадратного корня из чисел с помощью map</span>
<span class="c1">// и вывод результатов в консоль с помощью forEach</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span> <span class="c1">// 1 2 3 4</span>
<span class="p">});</span></code></pre></figure>

<h5>map своими руками</h5>

<p>Как и при создании аналога <code>forEach</code> напишем небольшие правила, которыми будем руководствоваться при создании функции <code>map</code>:</p>

<ol>
<li>Функция возвращает <strong>новый</strong> массив, оставляя исходный без изменений.</li>
<li>Всё, что возвращает <code>callback</code> функция добавляется в новый массив.</li>
<li>Функция принимает три аргумента: массив, по которому будет происходить итерация, <code>callback</code> фунцию, которая будет выполнена для каждого элемента массива, и значение, которое будет использовано <code>callback</code> функцией в качестве <code>this</code>.</li>
<li><code>callback</code> функция, в свою очередь, также работает с тремя аргументами: текущий элемент массива, индекс элемента, ссылка на сам массив.</li>
</ol>

<p>Правил стало больше, но последними двумя мы уже пользовались при создании функции <code>each</code>, а, значит, вы уже знаете, как с ними справиться. </p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">arr</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
<span class="p">};</span></code></pre></figure>

<p>Менять исходный массив нельзя, поэтому нужно создать новый массив в самом начале выполнения функции <code>map</code>. Назовём его <code>results</code>. В созданный нами массив <code>results</code> при кажом выполнении будем добавлять результат выполнения функции <code>callback</code> с помощью метода <code>push</code>. После завершения последней итерации всё, что остаётся сделать — вернуть массив <code>results</code>.</p>

<p>Написанная нами функция <code>map</code> работает точно так же, как и метод массивов <code>map</code>, но, как и <code>each</code>, может принимать в качестве аргументов любый другие коллекции.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">pows</span> <span class="o">=</span> <span class="nx">map</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">frameworks</span> <span class="o">=</span> <span class="nx">map</span><span class="p">([</span><span class="s1">'Knockout'</span><span class="p">,</span> <span class="s1">'Backbone'</span><span class="p">,</span> <span class="s1">'Angular'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">framework</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">framework</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">pows</span><span class="p">);</span> <span class="c1">// [1,20,900]</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">frameworks</span><span class="p">);</span> <span class="c1">// ["Knock","Backb","Angul"]</span></code></pre></figure>

<p><strong>Небольшой совет</strong>: не используйте метод <code>map</code> для манипуляций с коллекциями DOM элементов, например, чтобы добавить класс всем элементам коллекции.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[].</span><span class="nx">map</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">links</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">link</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'link'</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>Данный код сработает и всем ссылкам будет добавлен класс <code>link</code>, но пимимо этого будет создан дополнительный пустой массив, что скажется на производительности при большом объеме итерируемой коллекции. В подобных случаях следует использовать исключительно <code>forEach</code>. </p>

<p>Тем не менее, <code>map</code> отлично подходит для получения данных из DOM коллекций. Например, получение всех <code>href</code> атрибутов будет выглядеть следующим образом:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">hrefs</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">map</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">links</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">link</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">hrefs</span><span class="p">);</span> <span class="c1">// ["http://google.ru", "http://jsraccoon.ru" ...]</span></code></pre></figure>

<h5>filter</h5>

<p>Метод <code>filter</code>, как и следует из названия, служит для фильтрации массива по правилам, заданным в <code>callback</code> функции. Так же, как в случае с <code>map</code> создаётся <strong>новый</strong> массив, куда добавляются все элементы прошедшие провеку колбэком.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">moreThanFive</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">45</span><span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">num</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">moreThanFive</span><span class="p">);</span> <span class="c1">// [20,24,6,45]</span></code></pre></figure>

<p>При использовании метода <code>filter</code> результатом выполнения может быть любое значение, но данные из исходного массива будут добавлены только в том случае, если значение является правдивым. Напомню, что правдивыми значениями являются все, кроме:</p>

<ol>
<li>пустой строки <code>&#39;&#39;</code></li>
<li>числа ноль <code>0</code></li>
<li><code>false</code></li>
<li><code>undefined</code></li>
<li><code>null</code></li>
</ol>

<p>Тем не менее, пользоваться подобным способом фильтрации массива не стоит в силу его неочевидности. Поэтому рекомендуется создавать <code>callback</code> функцию таким образом, чтобы она всегда возвращала либо <code>true</code>, либо <code>false</code>.</p>

<p>Немного более сложный пример использования метода <code>filter</code>. Допустим, что мы получаем JSON файл с сервера с подобным содержимым:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[{</span><span class="s2">"id"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Ernest"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"ebishop0@myspace.com"</span><span class="p">,</span><span class="s2">"isCustomer"</span><span class="p">:</span><span class="kc">false</span><span class="p">},</span>
<span class="p">{</span><span class="s2">"id"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Michael"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"mturner1@multiply.com"</span><span class="p">,</span><span class="s2">"isCustomer"</span><span class="p">:</span><span class="kc">false</span><span class="p">},</span>
<span class="p">{</span><span class="s2">"id"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Mildred"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"mwelch2@google.it"</span><span class="p">,</span><span class="s2">"isCustomer"</span><span class="p">:</span><span class="kc">false</span><span class="p">},</span>
<span class="p">{</span><span class="s2">"id"</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Jeremy"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"jwilson3@hostgator.com"</span><span class="p">,</span><span class="s2">"isCustomer"</span><span class="p">:</span><span class="kc">false</span><span class="p">},</span>
<span class="p">{</span><span class="s2">"id"</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Judy"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"jellis4@ameblo.jp"</span><span class="p">,</span><span class="s2">"isCustomer"</span><span class="p">:</span><span class="kc">true</span><span class="p">},</span>
<span class="p">{</span><span class="s2">"id"</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Judy"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"jrogers5@ow.ly"</span><span class="p">,</span><span class="s2">"isCustomer"</span><span class="p">:</span><span class="kc">false</span><span class="p">},</span>
<span class="p">{</span><span class="s2">"id"</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Chris"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"cbennett6@nasa.gov"</span><span class="p">,</span><span class="s2">"isCustomer"</span><span class="p">:</span><span class="kc">false</span><span class="p">},</span>
<span class="p">{</span><span class="s2">"id"</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Ruth"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"rmason7@simplemachines.org"</span><span class="p">,</span><span class="s2">"isCustomer"</span><span class="p">:</span><span class="kc">true</span><span class="p">},</span>
<span class="p">{</span><span class="s2">"id"</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Justin"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"jmedina8@indiegogo.com"</span><span class="p">,</span><span class="s2">"isCustomer"</span><span class="p">:</span><span class="kc">true</span><span class="p">},</span>
<span class="p">{</span><span class="s2">"id"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Dennis"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"dflores9@g.co"</span><span class="p">,</span><span class="s2">"isCustomer"</span><span class="p">:</span><span class="kc">true</span><span class="p">}]</span></code></pre></figure>

<p>После получения данных (с помощью AJAX или JSONP, например) мы хотим их отфильтровать, узнав из свойства <code>isCustomer</code>, является ли данных человек нашим клиентом или нет. Вот здесь и пригодится метод <code>filter</code>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// ...</span>
<span class="c1">// Получили данные с сервера и записали их в переменную data</span>
<span class="kd">var</span> <span class="nx">customers</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">person</span><span class="p">.</span><span class="nx">isCustomer</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">customers</span><span class="p">);</span>
<span class="c1">// [{"id":5,"name":"Judy","email":"jellis4@ameblo.jp","isCustomer":true},</span>
<span class="c1">// {"id":8,"name":"Ruth","email":"rmason7@simplemachines.org","isCustomer":true},</span>
<span class="c1">// {"id":9,"name":"Justin","email":"jmedina8@indiegogo.com","isCustomer":true},</span>
<span class="c1">// {"id":10,"name":"Dennis","email":"dflores9@g.co","isCustomer":true}]</span></code></pre></figure>

<p>Или же можно руководствоваться немного другим, более сложным принципом при выборе цели. Например, мы решили, что если email клиента не начинается с буквы <code>j</code>, то он определённо нам не подходит.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// ...</span>
<span class="c1">// Получили данные с сервера и записали их в переменную data</span>
<span class="kd">var</span> <span class="nx">customers</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">person</span><span class="p">.</span><span class="nx">email</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="s1">'j'</span><span class="p">;</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">customers</span><span class="p">);</span>
<span class="c1">// [{"id":4,"name":"Jeremy","email":"jwilson3@hostgator.com","isCustomer":false},</span>
<span class="c1">// {"id":5,"name":"Judy","email":"jellis4@ameblo.jp","isCustomer":true},</span>
<span class="c1">// {"id":6,"name":"Judy","email":"jrogers5@ow.ly","isCustomer":false},</span>
<span class="c1">// {"id":9,"name":"Justin","email":"jmedina8@indiegogo.com","isCustomer":true}]</span></code></pre></figure>

<h5>filter своими руками</h5>

<p>Как и для прошлых функций <code>map</code> и <code>forEach</code> напишем небольшой свод правил:</p>

<ol>
<li>Функция возвращает <strong>новый</strong> массив, оставляя исходный без изменений.</li>
<li>Данные исходного массива передаются в <code>callback</code> функцию. Результат выполнения <code>callback</code> функции решает будет ли добавлен данный элемент в новый массив.</li>
<li>Функция принимает три аргумента: массив, по которому будет происходить итерация, <code>callback</code> фунцию, которая будет выполнена для каждого элемента массива, и значение, которое будет использовано <code>callback</code> функцией в качестве <code>this</code>.</li>
<li><code>callback</code> функция, в свою очередь, также работает с тремя аргументами: текущий элемент массива, индекс элемента, ссылка на сам массив.</li>
</ol>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">filter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">arr</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
<span class="p">};</span></code></pre></figure>

<p>С помощью всё того же метода функций <code>call</code> мы вызываем <code>callback</code> функцию, но на этот раз всё, что нас будет интересовать — вернула ли функция правдивое значение. Если результат содержит правдивое значение, то данные будут добавлены в массив, если же нет, то просто проигнорированы.</p>

<p>Удостоверимся, что функция <code>filter</code> работает, как мы её и задумывали:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">strs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Hello'</span><span class="p">,</span> <span class="s1">','</span><span class="p">,</span> <span class="s1">'JavaScript'</span><span class="p">,</span> <span class="s1">'World'</span><span class="p">,</span> <span class="s1">'!'</span><span class="p">];</span>

<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">strs</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">!==</span> <span class="nx">str</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span> <span class="c1">// ["Hello","JavaScript","World"]</span></code></pre></figure>

<p><strong>Небольшой хак</strong>: чтобы отфильтровать все ложные значения из массива можно воспользоваться конструктором <code>Boolean</code>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">'JavaScript'</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">trueData</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">trueData</span><span class="p">);</span> <span class="c1">// [32,"JavaScript"]</span></code></pre></figure>

<h5>some и every</h5>

<p>Методы <code>some</code> и <code>every</code> во многом похожи друг на друга. Оба метода возвращают <code>true</code> или <code>false</code>. <code>some</code> возвращает <code>true</code> тогда, когда хотя бы один элемент массива отвечает переданным в <code>callback</code> функцию условиям. <code>every</code> вернёт <code>true</code>, когда все элементы массива отвечают данным условиям. Звучит грозно, но, на самом деле всё очень просто.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">fives</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">fives</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">five</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">five</span> <span class="o">===</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span> <span class="c1">// false — в массиве же есть шестёрка</span>

<span class="kd">var</span> <span class="nx">fives</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">fives</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">five</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">five</span> <span class="o">===</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span> <span class="c1">// true — теперь там только пятёрки, всё хорошо</span>

<span class="kd">var</span> <span class="nx">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">num</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span> <span class="c1">// true — в массиве есть хотя бы одно значение больше 3</span>

<span class="kd">var</span> <span class="nx">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">num</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span> <span class="c1">// false — в массиве нет ни одного значения меньше 5</span></code></pre></figure>

<p>Методы <code>some</code> и <code>every</code> очень удобно использовать вместе с методом <code>filter</code> для вложенных массивов. Чтобы понять, как это работает, опять представим, что мы получили данные с сервера в виде JSON файла, который содержит массив объектов (наших покупателей). У каждого покупателя есть свойство <code>purchases</code>, которое представляет собой список приобретённых покупателем товаров в нашем магазине ранее. </p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[{</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Wanda"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"wjenkins0@irs.gov"</span><span class="p">,</span><span class="s2">"purchases"</span><span class="p">:[</span><span class="s1">'iPhone'</span><span class="p">,</span> <span class="s1">'dishwasher'</span><span class="p">,</span> <span class="s1">'cucumbers'</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Nicholas"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"nkennedy1@ox.ac.uk"</span><span class="p">,</span><span class="s2">"purchases"</span><span class="p">:[</span><span class="s1">'tomatoes'</span><span class="p">,</span> <span class="s1">'toster'</span><span class="p">,</span> <span class="s1">'grill'</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Paula"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"pstephens2@boston.com"</span><span class="p">,</span><span class="s2">"purchases"</span><span class="p">:[</span><span class="s1">'apples'</span><span class="p">,</span> <span class="s1">'Macbook'</span><span class="p">,</span> <span class="s1">'iPhone'</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Fred"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"fpeterson3@reuters.com"</span><span class="p">,</span><span class="s2">"purchases"</span><span class="p">:[</span><span class="s1">'beef'</span><span class="p">,</span> <span class="s1">'pork'</span><span class="p">,</span> <span class="s1">'cheese'</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Andrew"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"awagner4@weebly.com"</span><span class="p">,</span><span class="s2">"purchases"</span><span class="p">:[</span><span class="s1">'cottage cheese'</span><span class="p">,</span> <span class="s1">'cream'</span><span class="p">,</span> <span class="s1">'candies'</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Steven"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"sgonzales5@mashable.com"</span><span class="p">,</span><span class="s2">"purchases"</span><span class="p">:[</span><span class="s1">'iMac'</span><span class="p">,</span> <span class="s1">'Android phone'</span><span class="p">,</span> <span class="s1">'Windows 10'</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Harry"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"hallen6@nasa.gov"</span><span class="p">,</span><span class="s2">"purchases"</span><span class="p">:[</span><span class="s1">'green grape'</span><span class="p">,</span> <span class="s1">'tomatoes'</span><span class="p">,</span> <span class="s1">'potatoes'</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Bonnie"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"breyes7@kickstarter.com"</span><span class="p">,</span><span class="s2">"purchases"</span><span class="p">:[</span><span class="s1">'Windows 10'</span><span class="p">,</span> <span class="s1">'dishwasher'</span><span class="p">,</span> <span class="s1">'grill'</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Lisa"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"lgreene8@spotify.com"</span><span class="p">,</span><span class="s2">"purchases"</span><span class="p">:[</span><span class="s1">'pork'</span><span class="p">,</span> <span class="s1">'iMac'</span><span class="p">,</span> <span class="s1">'cheese'</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Wayne"</span><span class="p">,</span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"wramos9@yahoo.com"</span><span class="p">,</span><span class="s2">"purchases"</span><span class="p">:[</span><span class="s1">'apples'</span><span class="p">,</span> <span class="s1">'cream'</span><span class="p">,</span> <span class="s1">'candies'</span><span class="p">]}]</span></code></pre></figure>

<p>Чтобы понять, какие клиенты нам принесли больше всего прибыли, мы хотим их отфильтровать и посмотреть, кто из них покупал у нас технику от Apple (iPhone, Macbook или iMac). Метод <code>some</code> поможет сделать это с помощью всего нескольких строк кода.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// ...</span>
<span class="c1">// Получили данные с сервера и записали их в переменную data</span>
<span class="kd">var</span> <span class="nx">customers</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">customer</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">purchases</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">purchase</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">purchase</span> <span class="o">===</span> <span class="s1">'iPhone'</span> <span class="o">||</span> <span class="nx">purchase</span> <span class="o">===</span> <span class="s1">'Macbook'</span> <span class="o">||</span> <span class="nx">purchase</span> <span class="o">===</span> <span class="s1">'iMac'</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">customers</span><span class="p">);</span>
<span class="c1">// [{"name":"Wanda","email":"wjenkins0@irs.gov","purchases":["iPhone","dishwasher","cucumbers"]},</span>
<span class="c1">// {"name":"Paula","email":"pstephens2@boston.com","purchases":["apples","Macbook","iPhone"]},</span>
<span class="c1">// {"name":"Steven","email":"sgonzales5@mashable.com","purchases":["iMac","Android phone","Windows 10"]},</span>
<span class="c1">// {"name":"Lisa","email":"lgreene8@spotify.com","purchases":["pork","iMac","cheese"]}]</span></code></pre></figure>

<h5>some и every своими руками</h5>

<p>Правила:</p>

<ol>
<li>Функция возвращает только <code>true</code> или <code>false</code></li>
<li>Каждое значение передаётся в <code>callback</code> функцию и на результате её выполнения для <strong>всех</strong> элементов массива решается, какой будет результат.</li>
<li>Функция принимает три аргумента: массив, по которому будет происходить итерация, <code>callback</code> фунцию, которая будет выполнена для каждого элемента массива, и значение, которое будет использовано <code>callback</code> функцией в качестве <code>this</code>.</li>
<li><code>callback</code> функция, в свою очередь, также работает с тремя аргументами: текущий элемент массива, индекс элемента, ссылка на сам массив.</li>
</ol>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">some</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">arr</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">};</span></code></pre></figure>

<p>Функция <code>some</code> при каждой итерации проверяет, является ли результат выполнения <code>callback</code> функции правдивым. Если она находит хотя бы один правдивый результат, то прерывает своё выполнение и сразу возвращает <code>true</code>.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">every</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">arr</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span></code></pre></figure>

<p>Функция <code>every</code> построена по противоположному принципу. Если хотя бы одно значение не является верным, то сразу же возвращается <code>false</code> без дальнейшего перебирания массива.</p>

<p>Функции <code>every</code> и <code>some</code> работают идентично соответствующим им методам и будут давать одинаковые резутаты. Тем не менее, написанные нами функции работают лучше нативных методов. Почему? Используя методы массивов <code>some</code> и <code>every</code> вы подразумеваете, что <code>callback</code> функция будет выполнена для всех элементов без исключения. Но, может оказаться так, что первый элемент в массиве уже содержит нужные нам данные и итерация по всем остальным будет абсолютно бесполезной. В написанных нами функциях таких итераций не будет — когда будет найдено искомое значение функция сразу же прекратит своё выполнение. Подобный подход может дать достаточно ощутимый прирост производительности при работе с большими объемами данных, например, с JSON файлами содержащими несколько тысяч объектов.</p>

<h5>reduce</h5>

<p><code>callback</code> функция всех рассмотренных выше методов массивов работает с одинаковым набором данных: значением, индексом и массивом. Метод <code>reduce</code> не такой, как все. Принцип его работы немного отличается от всех остальных методов. Начнём сразу с примера:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">result</span> <span class="o">+</span> <span class="nx">num</span><span class="p">;</span>
<span class="p">},</span> <span class="mi">0</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sum</span><span class="p">);</span> <span class="c1">// 150 сумма всех элементов массива</span></code></pre></figure>

<p>Метод <code>reduce</code> принимает два аргумента <code>callback</code> функцию и начальное значение, которое будет присвоено аргументу <code>result</code> в примере выше при первой итерации. <code>callback</code> функция принимает целых 4 аргумента: промежуточное значение (аргумент <code>result</code> в примере выше), элемент массива, индекс элемента и сам массив. После каждой итерации в промежуточное значение записываются новые данные, которые берутся из результата выполнения функции <code>callback</code> при прошлой итерации:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">result</span> <span class="o">+</span> <span class="nx">num</span><span class="p">;</span>
<span class="p">},</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">// Будет выведено в консоль</span>
<span class="c1">// 0 начальное значение</span>
<span class="c1">// 10 начальное значение + первый элемент в массиве = промежуточное значение</span>
<span class="c1">// 30 промежуточное значение + второй элемент в массиве = промежуточное значение</span>
<span class="c1">// 60 и так далее</span>
<span class="c1">// 100</span></code></pre></figure>

<p>Разумеется, <code>reduce</code> может работать с любыми типами данных, не только с числами. Пример со строками (в данном случае в качестве начального значения стоит передавать пустую строку):</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">strs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'JavaScript'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'awesome'</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">strs</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">phrase</span><span class="p">,</span> <span class="nx">word</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Перед первым словом не надо ставить пробел</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">?</span> <span class="nx">phrase</span> <span class="o">+</span> <span class="nx">word</span> <span class="p">:</span> <span class="nx">phrase</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> <span class="nx">word</span><span class="p">;</span>
<span class="p">},</span> <span class="s1">''</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span> <span class="c1">// JavaScript is awesome</span></code></pre></figure>

<p>Пример с многомерным массивом (начинаем с пустого массива):</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">arrs</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]];</span>
<span class="kd">var</span> <span class="nx">concat</span> <span class="o">=</span> <span class="nx">arrs</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">current</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[]);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">concat</span><span class="p">);</span> <span class="c1">// [1,2,3,4,5,6,7,8,9,10,11]</span></code></pre></figure>

<h5>reduce своими руками</h5>

<p>Вы уже знаете — у нас есть правила:</p>

<ol>
<li>Функция принимает три аргумента: массив, <code>callback</code> функцию, начальное значение.</li>
<li>После каждой итерации в промежуточное значение перезаписывается значением, полученным в результате выполнения <code>callback</code> функции.
3.<code>callback</code> функция принимает четыре аргумента: промежуточное значение, текущий элемент массива, индекс элемента, ссылка на сам массив.</li>
<li>Явно указать значение <code>this</code> нельзя.</li>
</ol>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">reduce</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">startValue</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">startValue</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">arr</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">};</span></code></pre></figure>

<p>В нативном методе указывать значение <code>this</code> нельзя, поэтому вместо введения в функцию ещё одного аргумента <code>thisArg</code> мы просто передаём <code>null</code> в вызов функции. </p>

<p>Протестируем написанную нами функцию <code>reduce</code> на предыдущих примерах, чтобы убедиться, что всё работает, как мы и ожидаем.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">arrs</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]];</span>
<span class="kd">var</span> <span class="nx">strs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'JavaScript'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'awesome'</span><span class="p">];</span>

<span class="kd">var</span> <span class="nx">strResults</span> <span class="o">=</span> <span class="nx">reduce</span><span class="p">(</span><span class="nx">strs</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">phrase</span><span class="p">,</span> <span class="nx">word</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">?</span> <span class="nx">phrase</span> <span class="o">+</span> <span class="nx">word</span> <span class="p">:</span> <span class="nx">phrase</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> <span class="nx">word</span><span class="p">;</span>
<span class="p">},</span> <span class="s1">''</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">arrResults</span> <span class="o">=</span> <span class="nx">reduce</span><span class="p">(</span><span class="nx">arrs</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">current</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[]);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">strResults</span><span class="p">);</span> <span class="c1">// JavaScript is awesome</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arrResults</span><span class="p">);</span> <span class="c1">// [1,2,3,4,5,6,7,8,9,10,11]</span></code></pre></figure>

  </div>

  

</article>

      </div>

    </div>

    
      <!-- Disqus Comments -->
      <div id="disqus_thread" class="wrapper comments"></div>
      <script>
        var disqus_config = function () {
          this.page.url = "http://jsraccoon.ru/fn-array-methods";
          this.page.identifier = 'fn-array-methods';
        };
          
        (function() {
          var d = document, s = d.createElement('script');
          s.src = '//jsraccoon.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
      <noscript>Включи уже JavaScript, чтобы посмотреть <a href="https://disqus.com/?ref_noscript" rel="nofollow">комментарии с Disqus.</a></noscript>
    

    <footer class="site-sooter">
  <div class="wrapper">
    <div class="social-section">
  <a href="https://github.com/rtivital/jsraccoon" class="social-icon github"><i class="fa fa-github"></i></a>
  <a href="http://vk.com/jsraccoon" class="social-icon vk"><i class="fa fa-vk"></i></a>
  <a href="https://twitter.com/frontendraccoon" class="social-icon twitter"><i class="fa fa-twitter"></i></a>
</div>
  </div>
</footer>
<!-- Google Analitics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-72078847-1', 'auto');
  ga('send', 'pageview');

</script>


<script src="./js/jquery.min.js"></script>
<script src="./js/velocity.min.js"></script>
<script src="./js/main.js"></script>

  </body>

</html>
