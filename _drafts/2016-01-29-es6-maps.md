---
title: "ES6: Maps"
date: 2016-01-29 10:50:58 +0300
identifier: es6-maps
categories: JavaScript

prevTitle: "Расширение литерала объектов"
prevLink: "http://jsraccoon.ru/es6-object-literal/"

description: "Краткие формы записи свойств и методов объектов немного сократят код и сделают его немного более читабельным относительно аналогичного кода в ES5. Тем не менее новые краткие формы записи накладывают некоторые ограчения при работе с рекурсией и передаче методов объекта в качестве callback функции."
---

Чаще всего объекты в JavaScript используются, как ассоциативные массивы, то есть содержат в себе данные по типу `ключ: значение`. Однако, у подобного подхода есть несколько очень неприятных недостатков. Главный недостаток — отсутствие возможности использовать в качестве ключей любые типы данных, кроме строк:
{% highlight javascript %}
var o = {};
var a = {i: 1}, 
    b = {i: 2};
o[a] = 'first';
o[b] = 'second';
console.log(o[a], o[b]); // second second
{% endhighlight %}

Что-то тут не так. Оба объекта `a` и `b` при передаче в качестве ключа объекту `o` подвергаются операции `toString()`, в результате чего после двух присваиваний в объекте остаётся всего один ключ `[object Object]`:
{% highlight javascript %}
Object.keys(o); // ["[object Object]"]
{% endhighlight %}

Чтобы решить подобную проблему в ES6 появились `Maps`:
{% highlight javascript %}
const m = new Map();
const a = {i: 1}, 
      b = {i: 2};
m.set(a, 'first');
m.set(b, 'second');

m.get(a); // first
m.get(b); // second
{% endhighlight %}

Единственный недостаток использования Maps — нельзя получить доступ к значениям с помощью квадратных скобок `map[так нельзя]`. Тем не менее методы `get(ключ)` и `set(ключ, значение)` работают таким же образом.

##### Удаление свойств
Чтобы удалить свойство из map не используйте оператор `delete`. Ему на замену есть свойство `delete`:
{% highlight javascript %}
m.delete(a);
{% endhighlight %}

Чтобы полностью отчистить map от всех значений использeйте метод `clear`:
{% highlight javascript %}
const m = new Map();
const a = {i: 1}, 
      b = {i: 2};
m.set(a, 'first');
m.set(b, 'second');

m.clear();

m.get(a); // здесь ничего нет
m.get(b); // здесь ничего нет
{% endhighlight %}

##### Длина 
Для получения длины используйте свойство `size`, а не `length`. Заметьте, что отсчёт начинается не с нуля, а с единицы:
{% highlight javascript %}
const m = new Map();
const a = {i: 1}, 
      b = {i: 2};
m.set(a, 'first');
m.set(b, 'second');

m.size; // 2
{% endhighlight %}

##### Клонирование
Долгое время клонирование массивов и объектов было большой проблемой. Многие методы клонирования включали в себя несколько десятков строчек кода. Для клонирования объектов даже существует отдельный [npm пакет](https://www.npmjs.com/package/clone). Клонирование map 